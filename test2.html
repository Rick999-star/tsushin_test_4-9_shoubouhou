<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>実力テスト 第2回 - 消防法令[4-9] 学習サイト</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts Noto Sans JP -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
        }
        /* 正解・不正解のスタイル */
        .correct {
            border-width: 2px;
            border-color: #10B981; /* green-500 */
        }
        .incorrect {
            border-width: 2px;
            border-color: #EF4444; /* red-500 */
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen py-10">

    <div class="max-w-3xl mx-auto bg-white p-8 rounded-xl shadow-2xl">
        <h1 class="text-3xl font-bold text-gray-800 mb-8 text-center border-b pb-4">
            実力テスト 第2回 (20問)
        </h1>

        <!-- スコア表示エリア -->
        <div id="score-container" class="hidden mb-6 p-6 bg-purple-50 border border-purple-200 rounded-lg text-center">
            <h2 id="score-text" class="text-2xl font-bold text-purple-700"></h2>
        </div>

        <!-- クイズフォーム -->
        <form id="quiz-form" class="space-y-6">
            <!-- 問題はここに動的に挿入されます -->
        </form>

        <!-- 採点ボタンとトップへのリンク -->
        <div class="mt-10 text-center">
            <button id="submit-btn"
                    type="button"
                    class="py-3 px-8 bg-purple-600 text-white text-lg font-semibold rounded-lg shadow-md hover:bg-purple-700 transition duration-300 transform hover:-translate-y-1">
                採点する
            </button>
            <a href="index.html"
               id="home-link"
               class="inline-block py-3 px-6 bg-gray-600 text-white font-semibold rounded-lg shadow-md hover:bg-gray-700 transition duration-300 mt-4">
                トップページに戻る
            </a>
        </div>
    </div>

    <script>
        // 実力テスト 第2回データ (quiz_data.json の "test2" に相当)
        const quizData = [
            { "type": "multipleChoice", "question": "「消火活動上必要な施設」は、消防法において全部でいくつ定められているか。", "options": ["3つ", "4つ", "5つ", "6つ"], "answer": "5つ" },
            { "type": "fillInTheBlank", "question": "消防用設備等のうち、防火水槽や消火栓などが分類されるカテゴリは「( )」である。", "keywords": ["消防用水"], "acceptableAnswers": ["しょうぼうようすい"] },
            { "type": "multipleChoice", "question": "「消防の用に供する設備」の覚え方「用は避・警・消」の「避」が指す設備分類はどれか。", "options": ["消火設備", "警報設備", "避難設備", "排煙設備"], "answer": "避難設備" },
            { "type": "multipleChoice", "question": "「消防の用に供する設備」の覚え方「用は避・警・消」の「警」が指す設備分類はどれか。", "options": ["消火設備", "警報設備", "避難設備", "警戒区域"], "answer": "警報設備" },
            { "type": "fillInTheBlank", "question": "「消防の用に供する設備」の覚え方「用は避・警・消」の「消」が指す設備分類は「( )設備」である。", "keywords": ["消火"], "acceptableAnswers": ["しょうか"] },
            { "type": "multipleChoice", "question": "次のうち、消防法に基づく「誘導灯」に関する記述として正しいものはどれか。", "options": ["停電時に床面を照らす白色のライトである。", "建築基準法によって設置が義務付けられている。", "避難口や避難経路を示す緑色のライトである。", "消防隊の活動支援施設に分類される。"], "answer": "避難口や避難経路を示す緑色のライトである。" },
            { "type": "multipleChoice", "question": "次のうち、建築基準法に基づく「非常用の照明装置」に関する記述として正しいものはどれか。", "options": ["停電時に床面を照らす白色のライトである。", "消防法によって設置が義務付けられている。", "避難口や避難経路を示す緑色のライトである。", "警報設備に分類される。"], "answer": "停電時に床面を照らす白色のライトである。" },
            { "type": "multipleChoice", "question": "不活性ガス消火設備が設置される場所として、最も適切なものはどれか。", "options": ["劇場の舞台", "一般家庭の台所", "サーバールームや電気室", "地下駐車場"], "answer": "サーバールームや電気室" },
            { "type": "fillInTheBlank", "question": "連結送水管や連結散水設備において、消防隊が地上で水を送り込む接続口を「( )」という。", "keywords": ["送水口"], "acceptableAnswers": ["そうすいこう"] },
            { "type": "fillInTheBlank", "question": "高層ビルの各階に設置され、消防隊が連結送水管にホースを接続して放水する部分を「( )」という。", "keywords": ["放水口"], "acceptableAnswers": ["ほうすいこう"] },
            { "type": "multipleChoice", "question": "次のうち、「消火活動上必要な施設」に含まれないものはどれか。", "options": ["連結送水管", "非常コンセント設備", "無線通信補助設備", "非常放送設備"], "answer": "非常放送設備" },
            { "type": "multipleChoice", "question": "次のうち、「警報設備」に含まれるものはどれか。", "options": ["排煙設備", "誘導標識", "ガス漏れ火災警報設備", "消火器"], "answer": "ガス漏れ火災警報設備" },
            { "type": "multipleChoice", "question": "次のうち、「消火設備」に含まれるものはどれか。", "options": ["スプリンクラー設備", "連結散水設備", "連結送水管", "排煙設備"], "answer": "スプリンクラー設備" },
            { "type": "multipleChoice", "question": "次のうち、「避難設備」に含まれるものはどれか。", "options": ["非常コンセント設備", "誘導標識", "非常用の照明装置", "非常ベル"], "answer": "誘導標識" },
            { "type": "fillInTheBlank", "question": "地下街や高層ビル内部など、電波が届きにくい場所で消防隊の通信を確保する設備は「( )補助設備」である。", "keywords": ["無線通信"], "acceptableAnswers": ["むせんつうしん"] },
            { "type": "multipleChoice", "question": "火災通報装置をIP電話回線に接続する場合、停電に備えて回線終端装置等（ONU等）に必要な措置はどれか。", "options": ["予備電源の対応", "ナンバー・ディスプレイの契約", "専用の開閉器の設置", "コールバック機能の無効化"], "answer": "予備電源の対応" },
            { "type": "multipleChoice", "question": "NTT固定電話のIP網移行に伴い、一部の火災通報装置で消防機関からの折り返し（コールバック）を受けられなくなる問題の改善策として、適切でないものはどれか。", "options": ["ナンバー・ディスプレイ契約等をやめる。", "加入電話回線と火災通報装置の回線を分ける。", "コールバック信号に対応した機種に交換する。", "IP電話回線の通信速度を上げる契約をする。"], "answer": "IP電話回線の通信速度を上げる契約をする。" },
            { "type": "fillInTheBlank", "question": "消防用設備等の点検のうち、非常用発電機の「( )点検」は6か月に1回実施される。", "keywords": ["機器"], "acceptableAnswers": ["きき"] },
            { "type": "fillInTheBlank", "question": "消防用設備等の点検のうち、非常用発電機の「( )点検」（負荷試験）は原則1年に1回実施される。", "keywords": ["総合"], "acceptableAnswers": ["そうごう"] },
            { "type": "multipleChoice", "question": "変電設備（20kW以上）や蓄電池設備（4,800Ah・セル以上）の設置工事開始7日前までに提出が必要な届出はどれか。", "options": ["電気設備設置届", "工事整備対象設備等着工届出", "消防用設備等設置届", "少量危険物の貯蔵・取扱届出"], "answer": "電気設備設置届" }
        ];

        document.addEventListener('DOMContentLoaded', () => {
            const quizForm = document.getElementById('quiz-form');
            const submitBtn = document.getElementById('submit-btn');

            // 問題をフォームに動的に挿入
            quizData.forEach((item, index) => {
                const questionIndex = index + 1;
                let contentHTML = `
                    <div id="question-${index}" class="p-5 border border-gray-200 rounded-lg shadow-sm bg-white">
                        <p class="text-lg font-semibold mb-4 text-gray-800">
                            <span class="text-purple-600 font-bold">問 ${questionIndex}:</span> ${item.question.replace(/\( \)/g, '<span class="font-bold text-red-500">( ? )</span>')}
                        </p>
                `;

                if (item.type === 'multipleChoice') {
                    contentHTML += `<div class="space-y-3">`;
                    item.options.forEach(option => {
                        const optionId = `q${index}-${option.replace(/\s+/g, '-')}`;
                        contentHTML += `
                            <label for="${optionId}" class="block p-3 border rounded-lg hover:bg-gray-50 transition duration-200 cursor-pointer has-[:checked]:bg-purple-50 has-[:checked]:border-purple-300">
                                <input type="radio" id="${optionId}" name="q${index}" value="${option}" class="mr-3">
                                ${option}
                            </label>
                        `;
                    });
                    contentHTML += `</div>`;
                } else if (item.type === 'fillInTheBlank') {
                    contentHTML += `
                        <input type="text" id="q${index}-input"
                               class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500"
                               placeholder="解答を入力してください">
                    `;
                }
                
                // 正解表示用のエリア
                contentHTML += `<div id="result-${index}" class="hidden mt-4 p-3 bg-gray-50 rounded-md"></div>`;
                contentHTML += `</div>`;
                quizForm.innerHTML += contentHTML;
            });

            // 採点ボタンのイベントリスナー
            submitBtn.addEventListener('click', () => {
                let score = 0;
                
                quizData.forEach((item, index) => {
                    const questionDiv = document.getElementById(`question-${index}`);
                    const resultDiv = document.getElementById(`result-${index}`);
                    let isCorrect = false;
                    let answerDisplay = '';

                    if (item.type === 'multipleChoice') {
                        const selected = document.querySelector(`input[name="q${index}"]:checked`);
                        if (selected && selected.value === item.answer) {
                            isCorrect = true;
                        }
                        answerDisplay = `<span class="font-semibold text-green-700">正解:</span> ${item.answer}`;
                    } else if (item.type === 'fillInTheBlank') {
                        const userInput = document.getElementById(`q${index}-input`).value.trim();
                        // キーワードのいずれかを含んでいれば正解とする
                        if (userInput && item.keywords.some(keyword => userInput.includes(keyword))) {
                            isCorrect = true;
                        }
                        answerDisplay = `<span class="font-semibold text-green-700">正解キーワード:</span> ${item.keywords.join(', ')}`;
                    }

                    // 正解・不正解のスタイル適用
                    questionDiv.classList.remove('border-gray-200');
                    if (isCorrect) {
                        score++;
                        questionDiv.classList.add('correct');
                    } else {
                        questionDiv.classList.add('incorrect');
                    }

                    // 正解の表示
                    resultDiv.innerHTML = answerDisplay;
                    resultDiv.classList.remove('hidden');
                });

                // スコアの表示
                const scoreContainer = document.getElementById('score-container');
                const scoreText = document.getElementById('score-text');
                scoreText.textContent = `あなたのスコア: ${score} / ${quizData.length} 点`;
                scoreContainer.classList.remove('hidden');

                // 採点ボタンを非表示にし、トップへ戻るボタンを強調
                submitBtn.style.display = 'none';
                
                // ページトップのスコア表示位置にスクロール
                scoreContainer.scrollIntoView({ behavior: 'smooth' });
            });
        });
    </script>
</body>
</html>
